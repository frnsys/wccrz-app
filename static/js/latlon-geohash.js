"use strict";var Geohash={};Geohash.base32="0123456789bcdefghjkmnpqrstuvwxyz",Geohash.encode=function(a,b,c){if("undefined"==typeof c){for(var d=1;d<=12;d++){var e=Geohash.encode(a,b,d),f=Geohash.decode(e);if(f.lat==a&&f.lon==b)return e}c=12}if(a=Number(a),b=Number(b),c=Number(c),isNaN(a)||isNaN(b)||isNaN(c))throw new Error("Invalid geohash");for(var g=0,h=0,i=!0,j="",k=-90,l=90,m=-180,n=180;j.length<c;){if(i){var o=(m+n)/2;b>=o?(g=2*g+1,m=o):(g*=2,n=o)}else{var p=(k+l)/2;a>=p?(g=2*g+1,k=p):(g*=2,l=p)}i=!i,5==++h&&(j+=Geohash.base32.charAt(g),h=0,g=0)}return j},Geohash.decode=function(a){var b=Geohash.bounds(a),c=b.sw.lat,d=b.sw.lon,e=b.ne.lat,f=b.ne.lon,g=(c+e)/2,h=(d+f)/2;return g=g.toFixed(Math.floor(2-Math.log(e-c)/Math.LN10)),h=h.toFixed(Math.floor(2-Math.log(f-d)/Math.LN10)),{lat:Number(g),lon:Number(h)}},Geohash.bounds=function(a){if(0===a.length)throw new Error("Invalid geohash");a=a.toLowerCase();for(var b=!0,c=-90,d=90,e=-180,f=180,g=0;g<a.length;g++){var h=a.charAt(g),i=Geohash.base32.indexOf(h);if(i==-1)throw new Error("Invalid geohash");for(var j=4;j>=0;j--){var k=i>>j&1;if(b){var l=(e+f)/2;1==k?e=l:f=l}else{var m=(c+d)/2;1==k?c=m:d=m}b=!b}}var n={sw:{lat:c,lon:e},ne:{lat:d,lon:f}};return n},Geohash.adjacent=function(a,b){if(a=a.toLowerCase(),b=b.toLowerCase(),0===a.length)throw new Error("Invalid geohash");if("nsew".indexOf(b)==-1)throw new Error("Invalid direction");var c={n:["p0r21436x8zb9dcf5h7kjnmqesgutwvy","bc01fg45238967deuvhjyznpkmstqrwx"],s:["14365h7k9dcfesgujnmqp0r2twvyx8zb","238967debc01fg45kmstqrwxuvhjyznp"],e:["bc01fg45238967deuvhjyznpkmstqrwx","p0r21436x8zb9dcf5h7kjnmqesgutwvy"],w:["238967debc01fg45kmstqrwxuvhjyznp","14365h7k9dcfesgujnmqp0r2twvyx8zb"]},d={n:["prxz","bcfguvyz"],s:["028b","0145hjnp"],e:["bcfguvyz","prxz"],w:["0145hjnp","028b"]},e=a.slice(-1),f=a.slice(0,-1),g=a.length%2;return d[b][g].indexOf(e)!=-1&&""!==f&&(f=Geohash.adjacent(f,b)),f+Geohash.base32.charAt(c[b][g].indexOf(e))},Geohash.neighbours=function(a){return{n:Geohash.adjacent(a,"n"),ne:Geohash.adjacent(Geohash.adjacent(a,"n"),"e"),e:Geohash.adjacent(a,"e"),se:Geohash.adjacent(Geohash.adjacent(a,"s"),"e"),s:Geohash.adjacent(a,"s"),sw:Geohash.adjacent(Geohash.adjacent(a,"s"),"w"),w:Geohash.adjacent(a,"w"),nw:Geohash.adjacent(Geohash.adjacent(a,"n"),"w")}},"undefined"!=typeof module&&module.exports&&(module.exports=Geohash);
